entity Elevador is port 
(

------Entradas------

--Comando--

c1,c2,c3,c4: in bit;
m1,m2,m3,m4: in bit;

--Sensores
s1,s21,s22,s31,s32,s4,pa,pf: in bit;

--clock
clk: in bit; 

------Saídas------

--Lâmpadas
l: out bit_vector (3 downto 0); 

--Motor
ms, md: out bit;

--Estado
st: out bit_vector (3 downto 0)

);
end Elevador;

architecture maquina of Elevador is

signal mem: bit_vector (3 downto 0):= "0000";
signal s2: bit;
signal s3: bit;
signal p: bit;
signal a1,a2,a3,a4: bit;

begin

s2 <= s21 and s22;
s3 <= s31 and s32;
p <= pf and (not pa);
a1 <= c1 or m1;
a2 <= c2 or m2;
a3 <= c3 or m3;
a4 <= c4 or m4;
 
process(clk)
begin

-- PARA O ESTADO 0000 (localização) ------------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando chegar ao primeiro andar) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------
if(clk' event and clk = '0' and mem = "0000" and s1 = '0' and p = '1') then

mem <= "0000";
md <= '1';
ms <= '0';
l <= "0000";

end if;

-- SEGUNDA TRANSIÇÃO (parando no primeiro andar) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0000" and s1 = '1' and p = '1') then

mem <= "0001";
l <= "0001";
md <= '0';
ms <= '0';

end if;

-- PARA O ESTADO 0001 (primeiro andar) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando...) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0001" and a1 = '0' and a2 = '0' and a3 = '0') then

mem <= "0001";
l <= "0001";
ms <= '0';
md <= '0';

end if;

-- SEGUNDA TRANSIÇÃO (subindo até o segundo, terceiro ou quarto)----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0001" and p = '1' and (a2 = '1' or a3 = '1' or a4 = '1')) then

mem <= "0010";
ms <= '1';
l <= "0000";
md <= '0';

end if;

-- PARA O ESTADO 0010 (subindo até o segundo) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando chegar no segundo)----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0010" and p = '1' and s2 = '0') then

mem <= "0010";
ms <= '1';
l <= "0000";
md <= '0';

end if;

-- SEGUNDA TRANSIÇÃO (parando no segundo)----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0010" and s2 = '1' and a2 = '1' and p = '1') then

mem <= "0011";
l <= "0010";
ms <= '0';
md <= '0';

end if;

-- TERCEIRA TRANSIÇÃO (esperando chegar ao terceiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0010" and p = '1' and s2 = '1' and a2 = '0') then

mem <= "0100";
ms <= '1';
l <= "0000";
md <= '0';

end if;

-- PARA O ESTADO 0100 (subindo até o terceiro ou quarto) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando chegar no terceiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0100" and p = '1' and s3 = '0') then

mem <= "0100";
ms <= '1';
l <= "0000";
md <= '0';

end if;

-- SEGUNDA TRANSIÇÃO (parando no terceiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0100" and s3 = '1' and p = '1' and a3 = '1') then

mem <= "0101";
l <= "0100";
ms <= '0';
md <= '0';

end if;

-- TERCEIRA TRANSIÇÃO (esperando chegar ao quarto) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0100" and p = '1' and a3 = '0' and s3 = '1') then

mem <= "0110";
ms <= '1';
md <= '0';
l <= "0000";

end if;

-- PARA O ESTADO 0110 (subindo até o quarto) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando chegar no quarto) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0110" and p = '1' and s4 = '0') then

mem <= "0110";
ms <= '1';
md <= '0';
l <= "0000";

end if;

-- SEGUNDA TRANSIÇÃO (parando no quarto) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0110" and p = '1' and s4 = '1') then

mem <= "0111";
l <= "1000";
ms <= '0';
ms <= '0';

end if;

-- PARA O ESTADO 0111 (quarto andar) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando...) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0111" and a1 = '0' and a2 = '0' and a3 = '0') then

mem <= "0111";
l <= "1000";
ms <= '0';
md <= '0';

end if;

-- SEGUNDA TRANSIÇÃO (descendo até o terceiro, segundo ou primeiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0111" and p = '1' and (a3 = '1' or a2 = '1' or a1 = '1')) then

mem <= "1000";
md <= '1';
ms <= '0';
l <= "0000";

end if;

-- PARA O ESTADO 1000 (esperando chegar no terceiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (continua esperando chegar no terceiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1000" and p = '1' and s3 = '0') then

mem <= "1000";
md <= '1';
ms <= '0';
l <= "0000";

end if;

-- SEGUNDA TRANSIÇÃO (parando no terceiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1000" and p = '1' and s3 = '1' and a3 = '1') then

mem <= "1001";
l <= "0100";
ms <= '0';
md <= '0';

end if;

-- TERCEIRA TRANSIÇÃO (indo para o segundo ou primeiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1000" and p = '1' and a3 = '0' and s3 = '1') then

mem <= "1010";
md <= '1';
ms <= '0';
l <= "0000";

end if;

-- PARA O ESTADO 1010 (esperando chegar no segundo) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (continua esperando chegar no segundo) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1010" and p = '1' and s2 = '0') then

mem <= "1010";
md <= '1';
ms <= '0';
l <= "0000";

end if;

-- SEGUNDA TRANSIÇÃO (parando no segundo) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1010" and s2 = '1' and p = '1' and a2 = '1') then

mem <= "1011";
l <= "0010";
ms <= '0';
md <= '0';

end if;

-- TERCEIRA TRANSIÇÃO (descendo até o primeiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1010" and p = '1' and a2 = '0' and s2 = '1') then

mem <= "1100";
md <= '1';
ms <= '0';
l <= "0000";

end if;

-- PARA O ESTADO 1100 (descendo até o primeiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando chegar no primeiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1100" and p = '1' and s1 = '0') then

mem <= "1100";
md <= '1';
ms <= '0';
l <= "0000";

end if;

-- SEGUNDA TRANSIÇÃO (parando no primeiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1100" and s1 = '1' and p = '1') then

mem <= "0001";
l <= "0001";
ms <= '0';
md <= '0';

end if;

-- PARA O ESTADO 0011 (segundo andar) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando...) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0011" and a1 = '0' and a3 = '0' and a4 = '0') then

mem <= "0011";
l <= "0010";
ms <= '0';
md <= '0';

end if;

-- SEGUNDA TRANSIÇÃO (subindo para o terceiro ou quarto) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0011" and p = '1' and (a3 = '1' or a4 = '1')) then

mem <= "0100";
ms <= '1';
md <= '0';
l <= "0000";

end if;

-- TERCEIRA TRANSIÇÃO (mudando prioridade) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0011" and a1 = '1' and a3 = '0' and a4 = '0') then

mem <= "1011";
md <= '1';
ms <= '0';
l <= "0000";

end if;

-- PARA O ESTADO 1011 (segundo andar) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando...) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1011" and a1 = '0' and a3 = '0' and a4 = '0') then

mem <= "1011";
l <= "0010";
ms <= '0';
md <= '0';

end if;

-- SEGUNDA TRANSIÇÃO (descendo para o primeiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1011" and p = '1' and a1 = '1') then

mem <= "1100";
md <= '1';
ms <= '0';
l <= "0000";

end if;

-- TERCEIRA TRANSIÇÃO (descendo até o primeiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1011" and a1 = '0' and (a3 = '1' or a4 = '1')) then

mem <= "0011";
l <= "0010";
ms <= '0';
md <= '0';

end if;

-- PARA O ESTADO 0101 (terceiro andar) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando...) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0101" and a4 = '0' and a2 = '0' and a1 = '0') then

mem <= "0101";
l <= "0100";
md <= '0';
ms <= '0';

end if;

-- SEGUNDA TRANSIÇÃO (subindo para o quarto) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0101" and p = '1' and a4 = '1') then

mem <= "0110";
ms <= '1';
md <= '0';
l <= "0000";

end if;

-- TERCEIRA TRANSIÇÃO (mudando prioridade) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "0101" and a4 = '0' and (a1 = '1' or a2 = '1')) then

mem <= "1001";
l <= "0010";
ms <= '0';
md <= '0';

end if;

-- PARA O ESTADO 1001 (terceiro andar) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PRIMEIRA TRANSIÇÃO (esperando...) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1001" and a1 = '0' and a2 = '0' and a4 = '0') then

mem <= "1001";
l <= "0100";
ms <= '0';
md <= '0';

end if;

-- SEGUNDA TRANSIÇÃO (descendo para segundo ou primeiro) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1001" and p = '1' and (a2 = '1' or a1 = '1')) then

mem <= "1010";
md <= '1';
ms <= '0';
l <= "0000";


end if;

-- TERCEIRA TRANSIÇÃO (mudando prioridade) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(clk' event and clk = '0' and mem = "1001" and a4 = '1' and a1 = '0' and a2 = '0') then

mem <= "0101";
l <= "0100";
md <= '0';
ms <= '0';

end if;

end process; 

st <= mem;

end maquina;
